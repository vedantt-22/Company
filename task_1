// ... existing imports
import { ClassStats } from '../models/student.model';

// Inside StudentService class...

  getClassStats(): ClassStats {
    const students = this.students;
    const totalStudents = students.length;

    if (totalStudents === 0) {
      return { totalStudents: 0, classAverage: 0, highestPerformer: 'N/A', lowestPerformer: 'N/A' };
    }

    let totalClassScore = 0;
    let highestAvg = -1;
    let lowestAvg = 101;
    let highestName = 'N/A';
    let lowestName = 'N/A';
    let studentsWithGrades = 0;

    students.forEach(student => {
      if (student.grades && student.grades.length > 0) {
        // Calculate individual student average
        const sum = student.grades.reduce((a, b) => a + b.score, 0);
        const avg = sum / student.grades.length;
        
        totalClassScore += avg;
        studentsWithGrades++;

        // Check High/Low
        if (avg > highestAvg) {
          highestAvg = avg;
          highestName = student.name;
        }
        if (avg < lowestAvg) {
          lowestAvg = avg;
          lowestName = student.name;
        }
      }
    });

    const classAverage = studentsWithGrades > 0 ? (totalClassScore / studentsWithGrades) : 0;

    return {
      totalStudents,
      classAverage,
      highestPerformer: studentsWithGrades > 0 ? `${highestName} (${highestAvg.toFixed(1)}%)` : 'N/A',
      lowestPerformer: studentsWithGrades > 0 ? `${lowestName} (${lowestAvg.toFixed(1)}%)` : 'N/A'
    };
  }
